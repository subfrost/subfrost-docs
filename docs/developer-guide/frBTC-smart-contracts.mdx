---
title: FR-BTC Smart Contract
sidebar_label: FR-BTC Contract
sidebar_position: 4
---

# FR-BTC Smart Contract

The FR-BTC contract is the core Alkanes smart contract that manages the wrapping and unwrapping of Bitcoin. It runs on the Alkanes metaprotocol and is responsible for minting, burning, and tracking FR-BTC supply.

## Contract Location

| Property | Value |
|----------|-------|
| **Alkane ID** | `{32, 0}` |
| **Block** | 32 |
| **Transaction** | 0 |

The contract is deployed at genesis and is immutable.

## Contract Opcodes

The FR-BTC contract exposes the following methods via opcodes:

### Core Operations

| Opcode | Method | Parameters | Description |
|--------|--------|------------|-------------|
| `77` | `exchange()` | None | Wrap BTC to FR-BTC |
| `78` | `unwrap()` | `vout: u128, amount: u128` | Burn FR-BTC and queue BTC payment |

### Administration

| Opcode | Method | Parameters | Description |
|--------|--------|------------|-------------|
| `1` | `set_signer()` | `vout: u128` | Update signer pubkey (privileged) |

### Query Methods

| Opcode | Method | Returns | Description |
|--------|--------|---------|-------------|
| `99` | `get_name()` | `"Fractional BTC"` | Token name |
| `100` | `get_symbol()` | `"frBTC"` | Token symbol |
| `101` | `get_pending_unwraps()` | `Payment[]` | List pending payments |
| `102` | `get_decimals()` | `8` | Decimal places |
| `103` | `get_signer()` | `[u8; 32]` | Current signer pubkey |
| `105` | `get_total_supply()` | `u128` | Total FR-BTC supply |

## How exchange() Works (Opcode 77)

The `exchange()` method is the entry point for wrapping BTC to FR-BTC:

1. User creates a transaction with BTC sent to the signer address
2. Transaction includes a protostone calling opcode 77
3. Contract validates the BTC transfer
4. Contract mints equivalent FR-BTC to the pointer output

```
Transaction Structure:
├─ Output 0: BTC → Signer address
├─ Output 1: Receives FR-BTC (pointer target)
├─ Output 2+: Change
└─ OP_RETURN: Protostone with cellpack {32, 0, 77}
```

The wrapping is atomic—if the BTC transfer is invalid, no FR-BTC is minted.

## How unwrap() Works (Opcode 78)

The `unwrap()` method burns FR-BTC and queues a BTC payment:

1. User calls opcode 78 with output index and amount
2. Contract burns the specified FR-BTC
3. Contract creates a payment record in storage
4. SUBFROST signers fulfill the payment

```rust
// Payment record structure
Payment {
    spendable: OutPoint,  // Output user will receive
    output: TxOut,        // Payment details
    fulfilled: bool,      // Whether payment is complete
}
```

### Payment Storage

Payments are stored by block height:

```
/alkanes/{32:0}/storage/
  /payments/byheight/{height}  // Payments created at block
  /fulfilled                    // Fulfilled payment tracking
  /last_block                   // Last processed block
```

## Querying the Contract

### Get Signer Address

```bash
alkanes brc20-prog signer-address
```

Returns the Taproot address derived from the signer's x-only public key.

### Get Pending Unwraps

```bash
alkanes brc20-prog unwrap
```

Or:

```bash
alkanes alkanes unwrap --block-tag latest
```

### Get FR-BTC Balance

```bash
alkanes brc20-prog get-balance --address <ADDRESS>
```

Or:

```bash
alkanes alkanes getbalance --address <ADDRESS>
```

## Calling the Contract

### Wrap BTC

Using the simplified command:

```bash
alkanes alkanes wrap-btc 0.01 \
  --to bc1p... \
  --from bc1p... \
  --change bc1p... \
  --fee-rate 10 \
  -y
```

Using the execute command with protostone:

```bash
alkanes alkanes execute \
  --inputs "B:1000000" \
  --to "<SIGNER_ADDR>,bc1p..." \
  --protostones "[32,0,77]:v1:v1" \
  -y
```

### Unwrap FR-BTC

```bash
alkanes brc20-prog unwrap-btc <AMOUNT> \
  --vout <OUTPUT_INDEX> \
  --to <YOUR_BTC_ADDRESS> \
  -y
```

## Signer Management

The signer is the FROST threshold signature group that controls the BTC reserves:

### Query Current Signer

```bash
alkanes brc20-prog signer-address
```

### Signer Address Derivation

1. Call opcode 103 on contract `{32, 0}`
2. Receive 32-byte x-only public key
3. Create P2TR address from pubkey

```rust
// Pseudocode
let pubkey = contract.call(103);  // GET_SIGNER
let address = P2TR::from_xonly(pubkey);
```

## Contract Storage

The FR-BTC contract maintains the following state:

| Key | Type | Description |
|-----|------|-------------|
| `/signer` | `[u8; 32]` | Current signer pubkey |
| `/premium` | `u128` | Protocol premium (basis points) |
| `/payments/byheight/{n}` | `Vec<Payment>` | Payments at block n |
| `/fulfilled` | `Set<OutPoint>` | Fulfilled payment outputs |
| `/last_block` | `u64` | Last processed block |

## Security Model

### Atomic Wrapping

- Wrapping is trustless and permissionless
- BTC lock and FR-BTC mint happen in the same transaction
- If the BTC transfer fails, no FR-BTC is minted

### Trust-Minimized Unwrapping

- Unwrapping requires SUBFROST signer cooperation
- Signers monitor for unwrap events
- Multi-party threshold signature required for BTC release
- Users can verify pending payments on-chain

### Signer Authority

- Only the authorized signer can update the signer pubkey
- Signer pubkey is stored in contract state
- All wraps must send BTC to the current signer address

## See Also

- [FR-BTC Wrapping](./wrapping-frBTC) — Step-by-step wrapping guide
- [Alkanes CLI](./subfrost-cli) — CLI reference
- [Alkanes Protocol](../key-components/alkanes) — Protocol overview
